name: Setup build environment
description: Install build dependencies (default or debian)

inputs:
  profile:
    required: false
    default: default

runs:
  using: composite
  steps:
    - shell: bash
      run: |
        set -e
        sudo apt-get update

        if [ "${{ inputs.profile }}" = "debian" ]; then
          sudo apt-get install -y --no-install-recommends \
            build-essential \
            perl \
            fping \
            libc-ares-dev \
            libldap-dev \
            libpcre3-dev \
            librrd-dev \
            libssl-dev \
            libtirpc-dev
        else
          sudo apt-get install -y --no-install-recommends \
            build-essential \
            clang \
            perl \
            fping \
            libssl-dev \
            libpcre3-dev \
            librrd-dev \
            libldap2-dev \
            libtirpc-dev
        fi

        id xymon >/dev/null 2>&1 || sudo useradd -r -m -d /home/xymon -s /usr/sbin/nologin xymon
        sudo mkdir -p /home/xymon
        sudo chown xymon:xymon /home/xymon

